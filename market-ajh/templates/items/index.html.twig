{% extends 'base.html.twig' %}

{% block title %}Items de votre guilde{% endblock %}

{% block body %}
  <form method="get" action="{{ path('app_items_search') }}" class="mb-6">
    <div class="flex justify-center mt-4">
      <input
        type="text"
        name="q"
      class="form-input rounded-l-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 w-64 bg-WHITE"
        placeholder="Rechercher un item..."
        value="{{ app.request.get('q') }}"
      >
      <button class="bg-VIOLET text-WHITE px-3 py-2 rounded-r-md">
        Rechercher
      </button>
    </div>
  </form>

  {% if guildItems is not empty %}
    <div class="w-full max-w-7xl mx-auto">
      <div class="flex flex-wrap justify-center gap-6">
        {% for gi in guildItems %}
          <div class="flex-0 w-60 bg-GREEN  rounded-lg shadow-lg flex flex-col justify-around items-center p-6 transition-transform ">
            <div class="w-32 h-32 flex items-center justify-center mb-4 overflow-hidden rounded">
              {% if gi.item.image %}
                <img
                  src="{{ '/' ~ gi.item.image }}"
                  alt="{{ gi.item.nom }}"
                  class="object-cover w-full h-full"
                >
              {% else %}
                <span class="text-gray-400">Pas d'image</span>
              {% endif %}
            </div>
            <span class="font-semibold text-lg mb-2 text-center">{{ gi.item.nom }}</span>
            <span class="text-VIOLET font-bold mb-4">{{ gi.price }} €</span>
            <form
              method="post"
              action="{{ path('app_guild_items_delete', {'id': gi.id}) }}"
              onsubmit="return confirm('Supprimer cet item ?');"
              class="w-full"
            >
              <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ gi.id) }}">
              {% if is_granted('ROLE_ADMIN') %}
              <button class="bg-VIOLET text-WHITE px-3 py-1 rounded w-full border-2 border-transparent hover:border-VIOLET">
                Supprimer
              </button>
              {% endif %}
            </form>
            <form
              method="post"
              action="{{ path('app_guild_items_change_miseenvente') }}"
              class="w-full mt-2"
            >
              <input type="hidden" name="id" value="{{ gi.id }}">
              <div class="flex justify-center gap-2 mt-2">
                <button class="rounded-md bg-WHITE/10 px-2.5 py-1.5 text-sm font-semibold text-WHITE inset-ring inset-ring-WHITE/5 hover:bg-WHITE/20">
                  {% if gi.miseEnVente %}
                    Retirer de la vente
                  {% else %}
                    Remettre en vente
                  {% endif %}
                </button>
              </div>
              </form>
              <div class="flex justify-center gap-2">
                <script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
                <button command="show-modal" commandfor="dialog" class="rounded-md mt-2 bg-WHITE/10 px-2.5 py-1.5 text-sm font-semibold text-WHITE inset-ring inset-ring-WHITE/5 hover:bg-WHITE/20">Changer le prix</button>
              </div>
              <el-dialog>
                <dialog id="dialog" aria-labelledby="dialog-title" class="fixed inset-0 size-auto max-h-none max-w-none overflow-y-auto bg-transparent backdrop:bg-transparent">
                  <el-dialog-backdrop class="fixed inset-0 bg-gray-900/50 transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in"></el-dialog-backdrop>
                  <div tabindex="0" class="flex min-h-full items-end justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0">
                    <el-dialog-panel class="relative transform overflow-hidden rounded-lg bg-gray-800 text-left shadow-xl outline -outline-offset-1 outline-WHITE/10 transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:w-full sm:max-w-lg data-closed:sm:translate-y-0 data-closed:sm:scale-95">
                      <form method="post" action="{{ path('app_guild_items_change_price') }}">
                        <div class="bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                          <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex size-12 shrink-0 items-center justify-center rounded-full bg-blue-500/10 sm:mx-0 sm:size-10">
                              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-slot="icon" aria-hidden="true" class="size-6 text-blue-400">
                                <path d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12s-1.536-.219-2.121-.659c-1.172-.879-1.172-2.303 0-3.182C10.464 7.781 11.232 7.5 12 7.5s1.536.219 2.121.659" stroke-linecap="round" stroke-linejoin="round" />
                              </svg>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                              <h3 id="dialog-title" class="text-base font-semibold text-WHITE">Modifier le prix</h3>
                              <div class="mt-2">
                                <p class="text-sm text-gray-400 mb-4">Entrez le nouveau prix pour cet item.</p>
                                <input type="hidden" name="id" value="{{ gi.id }}">
                                <div class="mb-4">
                                  <label for="price" class="block text-sm font-medium text-gray-300 mb-2">Nouveau prix (€)</label>
                                  <input 
                                    type="number" 
                                    step="0.01" 
                                    min="0" 
                                    name="price" 
                                    id="price" 
                                    value="{{ gi.price }}"
                                    class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-WHITE focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    required
                                  >
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="bg-gray-700/25 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                          <button type="submit" class="inline-flex w-full justify-center rounded-md bg-blue-500 px-3 py-2 text-sm font-semibold text-WHITE hover:bg-blue-400 sm:ml-3 sm:w-auto">Modifier</button>
                          <button type="button" command="close" commandfor="dialog" class="mt-3 inline-flex w-full justify-center rounded-md bg-WHITE/10 px-3 py-2 text-sm font-semibold text-WHITE inset-ring inset-ring-WHITE/5 hover:bg-WHITE/20 sm:mt-0 sm:w-auto">Annuler</button>
                        </div>
                      </form>
                    </el-dialog-panel>
                  </div>
                </dialog>
              </el-dialog>
              </div>
            {% endfor %}
      </div>
    </div>
  {% else %}
    <p class="text-center text-gray-500">Aucun item n'est présent.</p>
  {% endif %}

  <div class="mt-6 flex justify-center">
    <a
      href="{{ path('app_guild_items_new') }}"
      class="bg-VIOLET text-WHITE px-4 py-2 rounded shadow"
    >
      Ajouter un nouvel item
    </a>
  </div>
{% endblock %}
