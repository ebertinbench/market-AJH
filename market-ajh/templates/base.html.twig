<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}market-ajh{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="{{ asset('build/images/logo_guilde.jpg') }}" />
    {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
      <link rel="stylesheet" href="{{ asset('build/app.css') }}" />
    {% endblock %}

    {% block javascripts %}
            {{ encore_entry_script_tags('app') }}
    {% endblock %}
  </head>
  <body
    class="bg-GRAY flex flex-col min-h-screen"
    {% if app.user %}
      style="background-image: url('{{ asset('build/images/wallpapers/' ~ app.user.wallpaper) }}'); background-size: cover; background-repeat: no-repeat; background-position: center; background-attachment: fixed;"
    {% else %}
      style="background-image: url('{{ asset('build/images/wallpapers/wallpaper1.png') }}'); background-size: cover; background-repeat: no-repeat; background-position: center; background-attachment: fixed;"
    {% endif %}
    
  >
    <!-- Navigation -->
    <nav class="bg-BLACK shadow-md p-4 relative z-50">
      <div class="w-full flex items-center justify-between px-4 relative">
        <!-- Logo à gauche -->
        <a href="{{ app.user ? path('app_home') : path('app_welcome') }}" class="flex-shrink-0">
          <img src="{{ asset('build/images/logo_guilde.jpg') }}" alt="Logo" class="h-16 w-16 rounded-full border-2 border-WHITE" />
        </a>

        <!-- Titre centré absolument par rapport à toute la largeur -->
        <div class="absolute hidden sm:block" style="left: 50vw; transform: translateX(-50%);">
          <span class="text-WHITE text-2xl font-bold">{{ nomdepage }}</span>
        </div>

        <div class="flex items-center space-x-3">
            <a href="https://discord.gg/rzr2c9vvsC" target="_blank" class="block w-35 rounded-lg px-4 py-2 bg-BLACK/60 text-WHITE border text-center border-WHITE">Rejoins-nous !</a>
            
            {% if not app.user %}
                <!-- Bouton de connexion pour les utilisateurs non connectés -->
                <a href="{{ path('app_login') }}" class="inline-flex items-center justify-center rounded-xl border border-PINK px-3 py-2 text-WHITE hover:bg-PINK/20 focus:outline-none focus:ring-2 focus:ring-PINK" title="Se connecter">
                    <span class="sr-only">Se connecter</span>
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7">
                        <path d="M20 12C20 7.58172 16.4183 4 12 4M12 20C14.5264 20 16.7792 18.8289 18.2454 17" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round"></path>
                        <path d="M4 12H14M14 12L11 9M14 12L11 15" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </a>
            {% endif %}
            
            {% if app.user %}
                <!-- Bouton Comptabilité -->
                {% if is_granted('ROLE_COMPTABLE') %}
                <a href="{{ path('app_compta') }}" class="inline-flex items-center justify-center rounded-xl border border-PINK px-3 py-2 text-WHITE hover:bg-PINK/20 focus:outline-none focus:ring-2 focus:ring-PINK" title="Comptabilité">
                    <span class="sr-only">Comptabilité</span>
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7">
                        <path d="M14 14H17M14 10H17M9 9.5V8.5M9 9.5H11.0001M9 9.5C7.20116 9.49996 7.00185 9.93222 7.0001 10.8325C6.99834 11.7328 7.00009 12 9.00009 12C11.0001 12 11.0001 12.2055 11.0001 13.1667C11.0001 13.889 11.0001 14.5 9.00009 14.5M9.00009 14.5L9 15.5M9.00009 14.5H7.0001M6.2 19H17.8C18.9201 19 19.4802 19 19.908 18.782C20.2843 18.5903 20.5903 18.2843 20.782 17.908C21 17.4802 21 16.9201 21 15.8V8.2C21 7.0799 21 6.51984 20.782 6.09202C20.5903 5.71569 20.2843 5.40973 19.908 5.21799C19.4802 5 18.9201 5 17.8 5H6.2C5.0799 5 4.51984 5 4.09202 5.21799C3.71569 5.40973 3.40973 5.71569 3.21799 6.09202C3 6.51984 3 7.07989 3 8.2V15.8C3 16.9201 3 17.4802 3.21799 17.908C3.40973 18.2843 3.71569 18.5903 4.09202 18.782C4.51984 19 5.07989 19 6.2 19Z" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </a>
                {% endif %}

                <!-- Bouton Commandes -->
                {% if is_granted('ROLE_VENDEUR') %}
                <a href="{{ path('orders_index') }}" class="inline-flex items-center justify-center rounded-xl border border-PINK px-3 py-2 text-WHITE hover:bg-PINK/20 focus:outline-none focus:ring-2 focus:ring-PINK" title="Voir les commandes">
                    <span class="sr-only">Voir les commandes</span>
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7">
                        <path d="M21 5L19 12H7.37671M20 16H8L6 3H3M11.5 7L13.5 9M13.5 9L15.5 7M13.5 9V3M9 20C9 20.5523 8.55228 21 8 21C7.44772 21 7 20.5523 7 20C7 19.4477 7.44772 19 8 19C8.55228 19 9 19.4477 9 20ZM20 20C20 20.5523 19.5523 21 19 21C18.4477 21 18 20.5523 18 20C18 19.4477 18.4477 19 19 19C19.5523 19 20 19.4477 20 20Z" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </a>
                {% endif %}

                <!-- Bouton Messagerie -->
                <a href="{{ path('app_messages_index') }}" class="relative inline-flex items-center justify-center rounded-xl border border-PINK px-3 py-2 text-WHITE hover:bg-PINK/20 focus:outline-none focus:ring-2 focus:ring-PINK" title="Messagerie">
                  <span class="sr-only">Messagerie</span>
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7">
                  <path d="M8 10.5H16" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round"></path>
                  <path d="M8 14H13.5" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round"></path>
                  <path d="M17 3.33782C15.5291 2.48697 13.8214 2 12 2C6.47715 2 2 6.47715 2 12C2 13.5997 2.37562 15.1116 3.04346 16.4525C3.22094 16.8088 3.28001 17.2161 3.17712 17.6006L2.58151 19.8267C2.32295 20.793 3.20701 21.677 4.17335 21.4185L6.39939 20.8229C6.78393 20.72 7.19121 20.7791 7.54753 20.9565C8.88837 21.6244 10.4003 22 12 22C17.5228 22 22 17.5228 22 12C22 10.1786 21.513 8.47087 20.6622 7" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round"></path>
                  </svg>
                  {% if app.user.unreadMessagesCount > 0 %}
                  <span class="absolute -top-2 -right-2 bg-red-500 text-WHITE text-xs font-bold px-2 py-1 rounded-full min-w-[20px] h-5 flex items-center justify-center">
                  {{ app.user.unreadMessagesCount }}
                  </span>
                  {% endif %}
                </a>

                <!-- Bouton Profil -->
                <a href="{{ path('app_profile') }}" class="inline-flex items-center justify-center rounded-xl border border-PINK px-3 py-2 text-WHITE hover:bg-PINK/20 focus:outline-none focus:ring-2 focus:ring-PINK" title="Profil">
                    <span class="sr-only">Profil</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </a>

                <!-- Bouton Comparateur de prix -->
                <a href="{{ path('shop_comparateur') }}" class="inline-flex items-center justify-center rounded-xl border border-PINK px-3 py-2 text-WHITE hover:bg-PINK/20 focus:outline-none focus:ring-2 focus:ring-PINK" title="Comparateur de prix">
                  <span class="sr-only">Comparateur de prix</span>
                  <svg fill="#FFFFFF" height="28px" width="28px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" xml:space="preserve">
                  <g>
                    <path d="M64,29.697c0-3.584-2.916-6.5-6.5-6.5h-4.499l9.464-16.392c0.534-0.925,0.676-2.003,0.4-3.036 C62.588,2.737,61.926,1.875,61,1.34c-0.925-0.534-2.004-0.676-3.035-0.399c-1.032,0.276-1.894,0.939-2.429,1.864L43.762,23.197 H20.237L8.464,2.805C7.929,1.879,7.067,1.217,6.035,0.941C5.004,0.665,3.925,0.806,3,1.34C2.074,1.875,1.412,2.737,1.136,3.769 c-0.277,1.032-0.135,2.11,0.4,3.036L11,23.197H6.5c-3.584,0-6.5,2.916-6.5,6.5c0,2.723,1.685,5.057,4.066,6.023l3.438,23.21 c0.36,2.433,2.487,4.267,4.946,4.267h38.222c2.41,0,4.477-1.72,4.916-4.089l4.33-23.382C62.308,34.763,64,32.425,64,29.697z M45.269,24.589l12-20.784c0.267-0.463,0.698-0.794,1.214-0.932c0.172-0.046,0.347-0.069,0.521-0.069 c0.347,0,0.689,0.091,0.997,0.269c0.463,0.267,0.794,0.698,0.932,1.214C61.071,4.803,61,5.342,60.732,5.805l-12,20.784 c-0.551,0.955-1.777,1.284-2.732,0.732c-0.463-0.267-0.793-0.698-0.932-1.214C44.93,25.591,45.001,25.052,45.269,24.589z M3.067,4.287c0.139-0.516,0.47-0.947,0.932-1.214c0.308-0.178,0.65-0.269,0.997-0.269c0.173,0,0.348,0.023,0.52,0.069 C6.032,3.011,6.463,3.342,6.73,3.805l12,20.784c0.267,0.463,0.338,1.002,0.2,1.518c-0.138,0.516-0.469,0.947-0.932,1.214 c-0.956,0.551-2.181,0.223-2.732-0.732l-12-20.784C3,5.342,2.929,4.803,3.067,4.287z M57.798,36.197l-4.175,22.546 c-0.263,1.422-1.504,2.454-2.95,2.454H12.451c-1.476,0-2.752-1.101-2.968-2.56l-3.324-22.44H6.5h51 C57.5,36.197,57.798,36.197,57.798,36.197z M57.5,34.197h-51c-2.481,0-4.5-2.019-4.5-4.5s2.019-4.5,4.5-4.5H12V24.93l1.535,2.659 c0.74,1.282,2.087,2,3.471,2c0.678,0,1.365-0.173,1.993-0.535c0.925-0.534,1.587-1.397,1.864-2.429 c0.127-0.473,0.155-0.955,0.108-1.428h22.057c-0.047,0.473-0.018,0.955,0.108,1.428c0.276,1.032,0.938,1.895,1.864,2.429 c0.628,0.363,1.315,0.535,1.993,0.535c1.383,0,2.731-0.718,3.471-2L52,24.93v0.267h5.5c2.481,0,4.5,2.019,4.5,4.5 S59.981,34.197,57.5,34.197z"></path>
                    <path d="M17,56.197c1.654,0,3-1.346,3-3v-10c0-1.654-1.346-3-3-3s-3,1.346-3,3v10C14,54.851,15.346,56.197,17,56.197z M16,43.197 c0-0.551,0.449-1,1-1s1,0.449,1,1v10c0,0.551-0.449,1-1,1s-1-0.449-1-1V43.197z"></path>
                  </g>
                  </svg>
                </a>
                

                <!-- Bouton Déconnexion -->
                <a href="{{ path('app_logout') }}" class="inline-flex items-center justify-center rounded-xl border border-PINK px-3 py-2 text-WHITE hover:bg-PINK/20 focus:outline-none focus:ring-2 focus:ring-PINK" title="Se déconnecter">
                    <span class="sr-only">Se déconnecter</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                </a>
            {% endif %}
            
            <!-- Bouton Burger à droite (seulement pour admins et chefs de guilde) -->
            {% if is_granted('ROLE_ADMIN') or (app.user is not null and app.user.guild is not null and app.user.guild.chef == app.user) %}
            <button
            id="burger-toggle"
            class="inline-flex items-center justify-center rounded-xl border border-PINK px-3 py-2 text-WHITE hover:bg-PINK/20 focus:outline-none focus:ring-2 focus:ring-PINK"
            aria-haspopup="true"
            aria-expanded="false"
            aria-controls="burger-menu"
            >
            <span class="sr-only">Ouvrir le menu</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
            </button>
            {% endif %}
        </div>
      </div>

      <!-- Panneau du menu burger -->
      <div
        id="burger-menu"
        class="hidden absolute right-4 mt-3 w-80 max-w-[92vw] rounded-2xl border border-PINK bg-BLACK/95 backdrop-blur shadow-2xl z-[60]"
        role="menu"
        aria-labelledby="burger-toggle"
      >
        <div class="p-3 max-h-[70vh] overflow-y-auto">
          <!-- En-tête -->
          <div class="flex items-center justify-between pb-2 mb-2 border-b border-PINK/40">
            <span class="text-WHITE font-bold text-lg">Menu</span>
            <button id="burger-close" class="p-2 rounded-lg text-WHITE hover:bg-PINK/20 focus:outline-none focus:ring-2 focus:ring-PINK" aria-label="Fermer le menu">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>

          </div>

          <!-- Sections par rôles -->
          <div class="space-y-4">
            {% if is_granted('ROLE_ADMIN') %}
              <section>
                <h3 class="text-WHITE/80 text-sm uppercase tracking-wide mb-2">Admin</h3>
                <ul class="space-y-2">
                  <li>
                    <a href="{{ path('app_user_index') }}" class="block w-full rounded-lg px-4 py-2 bg-BLACK/60 text-WHITE hover:bg-VIOLET border border-transparent hover:border-PINK transition">Gestion Utilisateurs</a>
                  </li>
                  <li>
                    <a href="{{ path('app_item_index') }}" class="block w-full rounded-lg px-4 py-2 bg-BLACK/60 text-WHITE hover:bg-VIOLET border border-transparent hover:border-PINK transition">Gestion Items</a>
                  </li>
                  <li>
                    <a href="{{ path('app_guild') }}" class="block w-full rounded-lg px-4 py-2 bg-BLACK/60 text-WHITE hover:bg-VIOLET border border-transparent hover:border-PINK transition">Gestion Guildes</a>
                  </li>
                  <li>
                    <a href="{{ path('app_news') }}" class="block w-full rounded-lg px-4 py-2 bg-BLACK/60 text-WHITE hover:bg-VIOLET border border-transparent hover:border-PINK transition">Nouvelle communication</a>
                  </li>
                </ul>
              </section>
            {% endif %}

            {% if app.user is not null and app.user.guild is not null and app.user.guild.chef == app.user %}
              <section>
                <h3 class="text-WHITE/80 text-sm uppercase tracking-wide mb-2">Chef de Guilde</h3>
                <ul class="space-y-2">
                  <li>
                    <a href="{{ path('app_guild_items_index') }}" class="block w-full rounded-lg px-4 py-2 bg-BLACK/60 text-WHITE hover:bg-VIOLET border border-transparent hover:border-PINK transition">Items de guilde</a>
                  </li>
                  <li>
                    <a href="{{ path('profile_add_members') }}" class="block w-full rounded-lg px-4 py-2 bg-BLACK/60 text-WHITE hover:bg-VIOLET border border-transparent hover:border-PINK transition">Ajouter un membre</a>
                  </li>
                </ul>
              </section>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Overlay pour clic extérieur (mobile/desktop) -->
      <div id="burger-overlay" class="hidden fixed inset-0 bg-black/40 z-[50]"></div>
    </nav>

    <!-- Flash messages -->
    <div id="flash-messages" class="fixed top-8 right-8 z-[80] flex flex-col items-end space-y-4 ">
      {% for label, messages in app.flashes %}
        {% for message in messages %}
          <div class="bg-WHITE text-BLACK px-8 py-6 rounded-xl shadow-2xl mb-2 min-w-[320px] text-center opacity-95 flash-message relative transition-all duration-300 translate-x-full">
            <span class="text-xl font-semibold">{{ message }}</span>
          </div>
        {% endfor %}
      {% endfor %}
    </div>

    <script>
      // Animations flash
      document.querySelectorAll('.flash-message').forEach(function (el, idx) {
        setTimeout(function () {
          el.classList.remove('translate-x-full');
          el.classList.add('translate-x-0');
        }, 50 + idx * 100);

        setTimeout(function () {
          el.classList.remove('translate-x-0');
          el.classList.add('translate-x-full');
        }, 2000);

        setTimeout(function () {
          el.style.display = 'none';
        }, 2300);
      });

      // Burger logic
      (function () {
        const btn = document.getElementById('burger-toggle');
        const menu = document.getElementById('burger-menu');
        const overlay = document.getElementById('burger-overlay');
        const closeBtn = document.getElementById('burger-close');

        function openMenu() {
          menu.classList.remove('hidden');
          overlay.classList.remove('hidden');
          btn.setAttribute('aria-expanded', 'true');
          const firstLink = menu.querySelector('a, button');
          if (firstLink) firstLink.focus();
        }

        function closeMenu() {
          menu.classList.add('hidden');
          overlay.classList.add('hidden');
          btn.setAttribute('aria-expanded', 'false');
          btn.focus();
        }

        // Empêche les clics à l'intérieur du menu d'être captés par le document/overlay
        if (menu) {
          menu.addEventListener('click', function (e) {
            e.stopPropagation();
          });
        }

        btn && btn.addEventListener('click', function (e) {
          e.stopPropagation();
          if (menu.classList.contains('hidden')) openMenu();
          else closeMenu();
        });

        closeBtn && closeBtn.addEventListener('click', function (e) {
          e.stopPropagation();
          closeMenu();
        });

        overlay && overlay.addEventListener('click', function (e) {
          e.stopPropagation();
          closeMenu();
        });

        // Ferme avec Echap & clic extérieur
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape') closeMenu();
        });
        document.addEventListener('click', function (e) {
          if (!menu.classList.contains('hidden')) {
            if (!menu.contains(e.target) && e.target !== btn) {
              closeMenu();
            }
          }
        });
      })();
    </script>
    <style>
      .flash-message {
        transform: translateX(100%);
        transition: transform 0.3s cubic-bezier(.4,0,.2,1), opacity 0.3s;
      }
      .flash-message.translate-x-0 { transform: translateX(0); }
      .flash-message.translate-x-full { transform: translateX(100%); }
    </style>

    <!-- Contenu principal -->
    <main class="flex flex-col flex-grow container mx-auto ">
      {% block body %}{% endblock %}
    </main>

    <!-- (Optionnel) Réaffichage brut des flashes si vous l'utilisiez déjà ailleurs -->
    {% for label, messages in app.flashes %}
      {% for message in messages %}
        <div class="alert alert-{{ label }}">
          {{ message }}
        </div>
      {% endfor %}
    {% endfor %}

    <!-- Footer -->
    <footer class="bg-BLACK text-WHITE p-4 border-t-2 border-PINK">
      <div class="container mx-auto px-4 text-center">
        <p class="text-PINK font-bold">&copy; {{ 'now'|date('Y') }} Boutique officielle de la guilde Ah-Jin</p>
        <p class="text-WHITE/80 mt-1">Tous droits réservés</p>
        <a href="{{ path('app_contact') }}" class="block w-full rounded-lg px-4 py-2 bg-BLACK/60 text-WHITE hover:bg-VIOLET border border-transparent">Nous contacter</a>
      </div>
    </footer>
  </body>
</html>
